<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | {{ restaurant_name }}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        .font-sans { font-family: 'Inter', sans-serif; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-height: 90vh; overflow-y: auto; }
        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>
    <script type="text/babel">
       // –í–Ω–µ–¥—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Jinja –¥–æ –±–ª–æ–∫–∞ raw
        const RESTAURANT_NAME = "{{ restaurant_name }}";
        const SECRET_LINK = "{{ secret_link }}";
        const RESTAURANT_ID = {{ restaurant_id }};

    {% raw %}
        const { useState, useEffect, useCallback, useRef, useMemo } = React;
        const API_BASE_URL = '/api';

const ORDER_STATUSES = [ "–°–±–æ—Ä –∫–æ—Ä–∑–∏–Ω—ã", "–û—Ç–º–µ–Ω–µ–Ω", "–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è", "–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ", "–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã", "–ì–æ—Ç–æ–≤–∏—Ç—Å—è", "–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è", "–£—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω"];
        function AdminPanel() {
            const [activeTab, setActiveTab] = useState('orders');

            const renderContent = () => {
                switch (activeTab) {
                    case 'orders': return <OrderManager />;
                    case 'menu': return <MenuManager />;
                    case 'categories': return <CategoryManager />;
                    case 'slider': return <SliderManager />;
                    case 'staff': return <StaffManager />;
                    case 'settings': return <SettingsManager />;
                    default: return <OrderManager />;
                }
            };

            return (
                <div className="flex h-screen overflow-hidden">
                    <nav className="w-64 bg-slate-900 text-slate-300 flex flex-col shadow-2xl z-10">
                        <div className="p-6 border-b border-slate-700">
                            <h1 className="text-xl font-bold text-white mb-1">{RESTAURANT_NAME}</h1>
                            <p className="text-xs text-slate-500">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                        </div>

                        <ul className="flex-1 overflow-y-auto py-4 space-y-1 px-3">
                            <NavItem icon="fa-receipt" label="–ó–∞–∫–∞–∑—ã" name="orders" activeTab={activeTab} setActiveTab={setActiveTab} />
                            <NavItem icon="fa-utensils" label="–ú–µ–Ω—é" name="menu" activeTab={activeTab} setActiveTab={setActiveTab} />
                            <NavItem icon="fa-tags" label="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏" name="categories" activeTab={activeTab} setActiveTab={setActiveTab} />
                            <NavItem icon="fa-images" label="–ë–∞–Ω–Ω–µ—Ä—ã" name="slider" activeTab={activeTab} setActiveTab={setActiveTab} />
                            <NavItem icon="fa-users" label="–ü–µ—Ä—Å–æ–Ω–∞–ª" name="staff" activeTab={activeTab} setActiveTab={setActiveTab} />
                            <NavItem icon="fa-cogs" label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" name="settings" activeTab={activeTab} setActiveTab={setActiveTab} />
                        </ul>

                        <div className="p-4 border-t border-slate-700 bg-slate-800/50">
                            <div className="text-xs text-slate-500 mb-2 text-center break-all">
                                üîí –°–µ–∫—Ä–µ—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞:<br/>
                                <span className="text-amber-500 select-all">/admin/{SECRET_LINK}</span>
                            </div>
                             <a href="/logout" className="block text-center text-slate-400 hover:text-white transition text-sm">
                               <i className="fa-solid fa-sign-out-alt mr-2"></i>–í—ã—Ö–æ–¥
                            </a>
                        </div>
                    </nav>
                    <main className="flex-1 bg-slate-100 overflow-y-auto p-8 relative">
                        {renderContent()}
                    </main>
                </div>
            );
        }

        const NavItem = ({ icon, label, name, activeTab, setActiveTab }) => (
            <li>
                <button onClick={() => setActiveTab(name)}
                    className={`w-full flex items-center space-x-3 p-3 rounded-lg text-left font-medium transition-all duration-200 ${activeTab === name ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/20' : 'hover:bg-slate-800 hover:text-white'}`}>
                    <i className={`fa-solid ${icon} w-6 text-center`}></i>
                    <span>{label}</span>
                </button>
            </li>
        );

        function OrderManager() {
            const [orders, setOrders] = useState([]);
            const [chatOrder, setChatOrder] = useState(null);
            const [notification, setNotification] = useState(null);
            const [audioEnabled, setAudioEnabled] = useState(false); // –°–æ—Å—Ç–æ—è–Ω–∏–µ "–ó–≤—É–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω"

            const isFirstLoad = useRef(true);
            const prevOrdersRef = useRef({});

            // –§—É–Ω–∫—Ü–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è. –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç Audio –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞.
            const playSound = (type) => {
                if (!audioEnabled) return;

                const src = type === 'new'
                    ? 'https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3'
                    : 'https://assets.mixkit.co/active_storage/sfx/2866/2866-preview.mp3';

                const audio = new Audio(src);
                audio.volume = 1.0;
                audio.play().catch(e => console.warn("Audio play failed:", e));
            };

            // "–•–∞–±–∞" –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ. –í–µ—à–∞–µ—Ç—Å—è –Ω–∞ –∫–Ω–æ–ø–∫—É.
            const enableAudioContext = () => {
                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ç–∏—à–∏–Ω—É –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —Å–Ω—è–ª –±–ª–æ–∫
                const silent = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
                silent.volume = 0;
                silent.play().then(() => {
                    setAudioEnabled(true); // –£—Å–ø–µ—Ö! –¢–µ–ø–µ—Ä—å –∑–≤—É–∫–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
                }).catch(e => {
                    console.error("Still blocked", e);
                    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–≤—É–∫.");
                });
            };

            // ... (generateOrderHash —Ç–æ—Ç –∂–µ) ...
            const generateOrderHash = (o) => `${o.id}|${o.status}|${o.total_price}|${o.items.length}|${JSON.stringify(o.items.map(i => i.quantity))}`;

            // ... (useEffect –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ç–æ—Ç –∂–µ) ...
            useEffect(() => {
                if (notification) {
                    const timer = setTimeout(() => setNotification(null), 7000);
                    return () => clearTimeout(timer);
                }
            }, [notification]);

            const fetchOrders = async () => {
                try {
                    const res = await fetch(`${API_BASE_URL}/orders/`);
                    if (!res.ok) return;
                    const newOrders = await res.json();

                    if (!isFirstLoad.current) {
                        const newHashes = {};
                        let newOrderAlert = null;
                        let updateOrderAlert = null;

                        newOrders.forEach(o => {
                            const hash = generateOrderHash(o);
                            newHashes[o.id] = hash;

                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∑–≤—É–∫–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ø–æ–∫–∞ –∑–∞–∫–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
                            if (o.status === '–°–±–æ—Ä –∫–æ—Ä–∑–∏–Ω—ã') return;

                            if (!prevOrdersRef.current[o.id]) {
                                newOrderAlert = o;
                            }
                            else if (prevOrdersRef.current[o.id] !== hash) {
                                updateOrderAlert = o;
                            }
                        });

                        if (newOrderAlert) {
                            playSound('new'); // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
                            setNotification({ type: 'new', title: 'üîî –ù–æ–≤—ã–π –∑–∞–∫–∞–∑!', msg: `–°—Ç–æ–ª ${newOrderAlert.table_number}` });
                        } else if (updateOrderAlert) {
                            playSound('update'); // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
                            setNotification({ type: 'update', title: 'üìù –ó–∞–∫–∞–∑ –∏–∑–º–µ–Ω–µ–Ω!', msg: `–°—Ç–æ–ª ${updateOrderAlert.table_number}` });
                        }
                        prevOrdersRef.current = newHashes;
                    } else {
                        const hashes = {};
                        newOrders.forEach(o => hashes[o.id] = generateOrderHash(o));
                        prevOrdersRef.current = hashes;
                        isFirstLoad.current = false;
                    }
                    setOrders(newOrders);
                } catch (e) { console.error(e); }
            };

            useEffect(() => {
                fetchOrders();
                const socket = io();

                // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∫–æ–º–Ω–∞—Ç—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤ —à–∞–±–ª–æ–Ω)
                socket.emit('join', { room: `rest_${RESTAURANT_ID}` });

                socket.on('new_order', (data) => {
                    playSound('new');
                    fetchOrders(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ
                });

                socket.on('status_change', () => {
                    fetchOrders();
                });

                return () => socket.disconnect();
            }, [audioEnabled]);
            // ... (handleStatusChange, getStatusColor —Ç–µ –∂–µ) ...
            const handleStatusChange = async (orderId, newStatus) => {
                setOrders(prev => prev.map(o => o.id === orderId ? { ...o, status: newStatus } : o));
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    const updatedOrder = { ...order, status: newStatus };
                    prevOrdersRef.current[orderId] = generateOrderHash(updatedOrder);
                }
                await fetch(`${API_BASE_URL}/orders/${orderId}/status`, {
                    method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ status: newStatus })
                });
            };
            const getStatusColor = (status) => {
                if (['–û—Ç–º–µ–Ω–µ–Ω', '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã'].includes(status)) return 'bg-red-100 text-red-800 border-red-200';
                if (status === '–£—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω') return 'bg-green-100 text-green-800 border-green-200';
if (status === '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è') return 'bg-amber-100 text-amber-800 border-amber-200 animate-pulse';
return 'bg-blue-50 text-blue-800 border-blue-200';
            };

            return (
                <div className="relative">
                    {/* –ö–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê */}
                    {!audioEnabled && (
                        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded shadow flex justify-between items-center">
                            <div>
                                <p className="font-bold">üî¥ –ó–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω</p>
                                <p className="text-sm">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —Å–ª—ã—à–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã.</p>
                            </div>
                            <button onClick={enableAudioContext} className="bg-red-600 text-white font-bold py-2 px-4 rounded hover:bg-red-700 transition animate-pulse">
                                –í–ö–õ–Æ–ß–ò–¢–¨ –ó–í–£–ö
                            </button>
                        </div>
                    )}

                    {notification && (
                        <div className={`fixed top-5 right-5 z-[9999] max-w-sm w-full bg-white rounded-xl shadow-2xl border-l-8 overflow-hidden cursor-pointer ${notification.type === 'new' ? 'border-green-500' : 'border-blue-500'}`} onClick={() => setNotification(null)}>
                            <div className="p-4 flex items-start">
                                <div className={`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-white mr-3 ${notification.type === 'new' ? 'bg-green-500' : 'bg-blue-500'}`}>
                                    <i className={`fa-solid ${notification.type === 'new' ? 'fa-bell' : 'fa-pen'} text-lg`}></i>
                                </div>
                                <div className="flex-1">
                                    <h4 className="font-bold text-gray-900 text-lg leading-tight mb-1">{notification.title}</h4>
                                    <p className="text-gray-600 text-sm">{notification.msg}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ... (–û—Å—Ç–∞–ª—å–Ω–æ–π JSX —Å —Ç–∞–±–ª–∏—Ü–µ–π –∑–∞–∫–∞–∑–æ–≤) ... */}
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold text-slate-800">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
                    </div>
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        {orders.length === 0 && <div className="col-span-2 text-center py-20 text-slate-400">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>}
                        {orders.map(order => (
                            <div key={order.id} className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 flex flex-col justify-between">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="flex items-center gap-4">
                                        <div className="w-14 h-14 rounded-xl bg-slate-900 text-white flex items-center justify-center font-bold text-2xl shadow-lg">
                                            {order.table_number || '?'}
                                        </div>
                                        <div>
                                            <h3 className="font-bold text-xl text-slate-800">–ó–∞–∫–∞–∑ #{order.id}</h3>
                                            <div className="text-xs text-slate-500 flex flex-col gap-1 mt-1">
                                                {order.phone_number && <span><i className="fa-solid fa-phone"></i> {order.phone_number}</span>}
                                                {order.waiter_name && <span className="text-purple-600"><i className="fa-solid fa-user-tie"></i> {order.waiter_name}</span>}
                                            </div>
                                        </div>
                                    </div>
                                    <select value={order.status} onChange={(e) => handleStatusChange(order.id, e.target.value)}
                                        className={`px-3 py-2 rounded-lg text-xs font-bold border outline-none cursor-pointer ${getStatusColor(order.status)}`}>
                                        {ORDER_STATUSES.map(s => <option key={s} value={s}>{s}</option>)}
                                    </select>
                                </div>
                                <div className="space-y-2 mb-4 bg-slate-50 p-4 rounded-xl border border-slate-100 max-h-40 overflow-y-auto">
                                    {order.items.map((item, idx) => (
                                        <div key={idx} className="flex justify-between text-sm items-center border-b border-slate-200 last:border-0 pb-2 last:pb-0 mb-2 last:mb-0">
                                            <span className="text-slate-700 font-medium">{item.name}</span>
                                            <span className="font-bold text-slate-900 bg-white px-2 py-0.5 rounded border border-slate-200 text-xs">x{item.quantity}</span>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex items-center justify-between pt-4 border-t border-slate-100 mt-auto">
                                    <div className="flex flex-col">
                                        <span className="text-xs text-slate-400 uppercase font-bold">–ò—Ç–æ–≥–æ</span>
                                        <span className="text-2xl font-bold text-slate-900">{order.total_price} ‚Ç∏</span>
                                    </div>
                                    <button onClick={() => setChatOrder(order.id)} className="flex items-center gap-2 bg-blue-50 text-blue-600 px-5 py-3 rounded-xl font-bold hover:bg-blue-100 transition">
                                        <i className="fa-regular fa-comments text-lg"></i> –ß–∞—Ç
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                    {chatOrder && <ChatModal orderId={chatOrder} onClose={() => setChatOrder(null)} />}
                </div>
            );
        }
        function ChatModal({ orderId, onClose }) {
            const [data, setData] = useState(null);
            const [input, setInput] = useState('');
            const chatEndRef = React.useRef(null);

            const fetchChat = useCallback(async () => {
                const res = await fetch(`${API_BASE_URL}/orders/${orderId}/chat`);
                if (res.ok) setData(await res.json());
            }, [orderId]);

            useEffect(() => {
                fetchChat();
                const interval = setInterval(fetchChat, 3000);
                return () => clearInterval(interval);
            }, [fetchChat]);

            useEffect(() => chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }), [data]);

            const sendMessage = async () => {
                if (!input.trim()) return;
                await fetch(`${API_BASE_URL}/orders/${orderId}/send_message`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: input })
                });
                setInput('');
                fetchChat();
            };

            const toggleBot = async () => {
                if (!data) return;
                await fetch(`${API_BASE_URL}/orders/${orderId}/toggle_bot`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_bot_active: !data.is_bot_active })
                });
                fetchChat();
            };

            if (!data) return null;

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content h-[600px] flex flex-col" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-4 border-b pb-4">
                            <div>
                                <h3 className="font-bold text-lg">–ß–∞—Ç –∑–∞–∫–∞–∑–∞ #{orderId}</h3>
                                <p className="text-xs text-slate-500">{data.customer_username}</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={toggleBot} className={`px-3 py-1 rounded-full text-xs font-bold transition ${data.is_bot_active ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                    {data.is_bot_active ? 'ü§ñ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω' : 'üë§ –û–ø–µ—Ä–∞—Ç–æ—Ä'}
                                </button>
                                <button onClick={onClose}><i className="fa-solid fa-xmark text-slate-400 hover:text-slate-800 text-xl"></i></button>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto space-y-3 p-2 bg-slate-50 rounded-xl mb-4 border border-slate-100">
                            {data.messages.length === 0 && <div className="text-center text-slate-400 mt-10">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>}
                            {data.messages.map((msg, idx) => {
                                const isMe = msg.sender === 'admin';
                                const isBot = msg.sender === 'bot';
                                return (
                                    <div key={idx} className={`flex ${isMe ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[80%] p-3 rounded-2xl text-sm ${isMe ? 'bg-blue-500 text-white' : isBot ? 'bg-slate-200 text-slate-600' : 'bg-white border border-slate-200 text-slate-800'}`}>
                                            {isBot && <div className="text-xs font-bold mb-1"><i className="fa-solid fa-robot"></i> Nomi</div>}
                                            {msg.content}
                                            <div className={`text-[10px] mt-1 text-right ${isMe ? 'text-blue-100' : 'text-slate-400'}`}>
                                                {new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                            <div ref={chatEndRef} />
                        </div>

                        <div className="flex gap-2">
                            <input value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && sendMessage()}
                                className="flex-1 border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." />
                            <button onClick={sendMessage} className="bg-blue-600 text-white px-6 rounded-xl hover:bg-blue-700 transition">
                                <i className="fa-solid fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- OTHER MANAGERS (UNCHANGED) ---

        function StaffManager() {
            const [staff, setStaff] = useState([]);
            const [modalOpen, setModalOpen] = useState(false);
            const [editUser, setEditUser] = useState(null);

            const fetchStaff = async () => {
                const res = await fetch(`${API_BASE_URL}/staff/`);
                setStaff(await res.json());
            };
            useEffect(() => { fetchStaff(); }, []);

            const handleSave = async (data) => {
                const url = editUser ? `${API_BASE_URL}/staff/${editUser.id}` : `${API_BASE_URL}/staff/`;
                const method = editUser ? 'PUT' : 'POST';

                const res = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                if (res.ok) { setModalOpen(false); setEditUser(null); fetchStaff(); }
                else { alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"); }
            };

            const handleDelete = async (id) => {
                if(confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?")) {
                    await fetch(`${API_BASE_URL}/staff/${id}`, { method: 'DELETE' });
                    fetchStaff();
                }
            };

            const openEdit = (u) => { setEditUser(u); setModalOpen(true); };

            return (
                <div>
                     <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold text-slate-800">–ü–µ—Ä—Å–æ–Ω–∞–ª —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</h2>
                        <button onClick={() => setModalOpen(true)} className="bg-green-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-green-600 shadow-lg transition">
                            <i className="fa-solid fa-user-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {staff.map(u => (
                            <div key={u.id} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex justify-between items-center">
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center text-xl">
                                        <i className="fa-solid fa-user-tie"></i>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-lg">{u.username}</h3>
                                        <p className="text-xs text-slate-500">
                                            {u.is_active ? <span className="text-green-500">–ê–∫—Ç–∏–≤–µ–Ω</span> : <span className="text-red-500">–û—Ç–∫–ª—é—á–µ–Ω</span>}
                                        </p>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => openEdit(u)} className="text-blue-400 hover:text-blue-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-blue-50 transition">
                                        <i className="fa-solid fa-pen"></i>
                                    </button>
                                    <button onClick={() => handleDelete(u.id)} className="text-red-400 hover:text-red-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-50 transition">
                                        <i className="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                        {staff.length === 0 && <p className="text-slate-500 col-span-3 text-center py-10">–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ!</p>}
                    </div>

                    {modalOpen && <StaffFormModal onClose={() => setModalOpen(false)} onSave={handleSave} />}
                </div>
            )
        }

        function StaffFormModal({ user, onClose, onSave }) {
            const [username, setUsername] = useState(user?.username || '');
            const [password, setPassword] = useState('');
            const [isActive, setIsActive] = useState(user?.is_active ?? true);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({ username, password, is_active: isActive });
            }

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h3 className="text-2xl font-bold mb-4">{user ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤—ã–π –æ—Ñ–∏—Ü–∏–∞–Ω—Ç'}</h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {!user && (
                            <div>
                                <label className="block text-sm font-medium mb-1">–õ–æ–≥–∏–Ω</label>
                                <input required className="w-full border p-2 rounded-lg" value={username} onChange={e => setUsername(e.target.value)} />
                            </div>
                            )}
                            <div>
                                <label className="block text-sm font-medium mb-1">{user ? '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è—Ç—å)' : '–ü–∞—Ä–æ–ª—å'}</label>
                                <input className="w-full border p-2 rounded-lg" type="password" value={password} onChange={e => setPassword(e.target.value)} required={!user} />
                            </div>
                            <label className="flex items-center gap-2 font-bold text-slate-700">
                                <input type="checkbox" checked={isActive} onChange={e => setIsActive(e.target.checked)} />
                                –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –∞–∫—Ç–∏–≤–Ω–∞
                            </label>
                            <div className="flex justify-end gap-2 pt-4">
                                <button type="button" onClick={onClose} className="px-4 py-2 text-slate-600 font-bold hover:bg-slate-100 rounded-lg">–û—Ç–º–µ–Ω–∞</button>
                                <button className="px-4 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600">–°–æ–∑–¥–∞—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            )
        }

        function CategoryManager() {
            const [categories, setCategories] = useState([]);
            const [form, setForm] = useState({ name: '', sort_order: 0, is_active: true });
            const [isEditing, setIsEditing] = useState(null);

            const fetchCats = async () => {
                const res = await fetch('/api/categories/');
                setCategories(await res.json());
            };
            useEffect(() => { fetchCats(); }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                const url = isEditing ? `/api/categories/${isEditing}` : '/api/categories/';
                const method = isEditing ? 'PUT' : 'POST';
                await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(form)
                });
                setForm({ name: '', sort_order: 0, is_active: true });
                setIsEditing(null);
                fetchCats();
            };

            const handleDelete = async (id) => {
                if(!confirm("–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?")) return;
                await fetch(`/api/categories/${id}`, { method: 'DELETE' });
                fetchCats();
            };

            const startEdit = (cat) => {
                setForm(cat);
                setIsEditing(cat.id);
            };

            return (
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 className="font-bold text-xl mb-4">{isEditing ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è'}</h3>
                        <form onSubmit={handleSubmit} className="space-y-3">
                            <input className="w-full border p-2 rounded" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value={form.name} onChange={e => setForm({...form, name: e.target.value})} required />
                            <input className="w-full border p-2 rounded" type="number" placeholder="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞" value={form.sort_order} onChange={e => setForm({...form, sort_order: parseInt(e.target.value)})} />
                            <label className="flex items-center gap-2">
                                <input type="checkbox" checked={form.is_active} onChange={e => setForm({...form, is_active: e.target.checked})} />
                                –ê–∫—Ç–∏–≤–Ω–∞
                            </label>
                            <button className="w-full bg-amber-500 text-white py-2 rounded font-bold">{isEditing ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å'}</button>
                            {isEditing && <button type="button" onClick={() => { setIsEditing(null); setForm({ name: '', sort_order: 0, is_active: true }); }} className="w-full bg-slate-200 mt-2 py-2 rounded">–û—Ç–º–µ–Ω–∞</button>}
                        </form>
                    </div>
                    <div className="col-span-2 space-y-2">
                        {categories.map(c => (
                            <div key={c.id} className="bg-white p-4 rounded-xl shadow-sm border flex justify-between items-center">
                                <div>
                                    <span className="font-bold text-lg">{c.name}</span>
                                    <span className="text-xs text-slate-400 ml-2">Sort: {c.sort_order}</span>
                                    {!c.is_active && <span className="ml-2 text-xs bg-red-100 text-red-600 px-2 py-1 rounded">Hidden</span>}
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => startEdit(c)} className="text-blue-500 p-2"><i className="fa-solid fa-pen"></i></button>
                                    <button onClick={() => handleDelete(c.id)} className="text-red-500 p-2"><i className="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function MenuManager() {
            const [items, setItems] = useState([]);
            const [categories, setCategories] = useState([]);
            const [modalOpen, setModalOpen] = useState(false);
            const [editItem, setEditItem] = useState(null);

            const fetchData = async () => {
                const [resItems, resCats] = await Promise.all([fetch('/api/menu/'), fetch('/api/categories/')]);
                setItems(await resItems.json());
                setCategories(await resCats.json());
            };
            useEffect(() => { fetchData(); }, []);

            const handleDelete = async (id) => {
                if(!confirm("–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ?")) return;
                await fetch(`/api/menu/${id}`, { method: 'DELETE' });
                fetchData();
            };

            return (
                <div>
                     <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold text-slate-800">–ú–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</h2>
                        <button onClick={() => { setEditItem(null); setModalOpen(true); }} className="bg-amber-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-amber-600 shadow-lg transition">
                            <i className="fa-solid fa-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {items.map(i => (
                            <div key={i.id} className="bg-white p-4 rounded-xl shadow-sm border flex gap-4">
                                <img src={i.image_url || 'https://placehold.co/100'} className="w-24 h-24 object-cover rounded-lg bg-slate-100" />
                                <div className="flex-1">
                                    <div className="flex justify-between">
                                        <h4 className="font-bold">{i.name}</h4>
                                        <span className="font-bold text-amber-600">{i.price} ‚Ç∏</span>
                                    </div>
                                    <p className="text-xs text-slate-500 line-clamp-2 mt-1">{i.description}</p>
                                    <div className="mt-2 flex gap-2 text-xs">
                                        {!i.is_active && <span className="bg-red-100 text-red-600 px-2 rounded">–°–∫—Ä—ã—Ç–æ</span>}
                                        <span className="bg-slate-100 px-2 rounded">Sort: {i.sort_order}</span>
                                        {i.stock !== null && <span className={`px-2 rounded border ${i.stock === 0 ? 'bg-red-50 text-red-500 border-red-200' : 'bg-green-50 text-green-600 border-green-200'}`}>–û—Å—Ç: {i.stock}</span>}
                                    </div>
                                </div>
                                <div className="flex flex-col justify-between">
                                    <button onClick={() => { setEditItem(i); setModalOpen(true); }} className="text-blue-500"><i className="fa-solid fa-pen"></i></button>
                                    <button onClick={() => handleDelete(i.id)} className="text-red-500"><i className="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {modalOpen && <MenuItemModal item={editItem} categories={categories} onClose={() => setModalOpen(false)} onSave={() => { setModalOpen(false); fetchData(); }} />}
                </div>
            );
        }

        function MenuItemModal({ item, categories, onClose, onSave }) {
            const isEdit = !!item;
            const [name, setName] = useState(item?.name || '');
            const [price, setPrice] = useState(item?.price || '');
            const [desc, setDesc] = useState(item?.description || '');
            const [sort, setSort] = useState(item?.sort_order || 0);
            const [active, setActive] = useState(item?.is_active ?? true);
            const [stock, setStock] = useState(item?.stock ?? null);
            const [selectedCats, setSelectedCats] = useState(item?.category_ids || []);
            const [file, setFile] = useState(null);

            const [imageUrl, setImageUrl] = useState(item?.image_url || '');
            const [isGenerating, setIsGenerating] = useState(false);
            const aiInputRef = React.useRef(null);

            const handleGoogleGenerate = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setIsGenerating(true);
                // –ó–∞–≥–ª—É—à–∫–∞
                setImageUrl('https://i.gifer.com/ZZ5H.gif');

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const res = await fetch('/api/menu/generate-image-google', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();

                    if (res.ok) {
                        setImageUrl(data.image_url);
                        if (!desc) setDesc(data.description);
                        alert("‚ú® Gemini & Imagen: –ë–ª—é–¥–æ –≥–æ—Ç–æ–≤–æ!");
                    } else {
                        alert("–û—à–∏–±–∫–∞: " + data.error);
                        setImageUrl('');
                    }
                } catch (err) {
                    alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
                    setImageUrl('');
                } finally {
                    setIsGenerating(false);
                    e.target.value = null;
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const fd = new FormData();
                fd.append('name', name);
                fd.append('price', price);
                fd.append('description', desc);
                fd.append('sort_order', sort);
                fd.append('is_active', active);
                if (stock !== null) fd.append('stock', stock);
                selectedCats.forEach(c => fd.append('categories', c));

                if (file) fd.append('image', file);
                if (!file && imageUrl) fd.append('image_url_direct', imageUrl);

                const url = isEdit ? `/api/menu/${item.id}` : '/api/menu/';

                if (isEdit && !file) {
                     await fetch(url, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            name, price, description: desc, sort_order: sort,
                            is_active: active, categories: selectedCats,
                            image_url: imageUrl,
                            stock: stock
                        })
                    });
                } else {
                    await fetch(url, { method: 'POST', body: fd });
                }
                onSave();
            };

            const toggleCat = (id) => {
                if (selectedCats.includes(id)) setSelectedCats(selectedCats.filter(c => c !== id));
                else setSelectedCats([...selectedCats, id]);
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content max-w-lg" onClick={e => e.stopPropagation()}>
                        <h3 className="text-2xl font-bold mb-4">{isEdit ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ' : '–ù–æ–≤–æ–µ –±–ª—é–¥–æ'}</h3>
                        <form onSubmit={handleSubmit} className="space-y-3">
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-4 shadow-sm">
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-2">AI –§–æ—Ç–æ—Å—Ç—É–¥–∏—è</label>
                                <input type="file" ref={aiInputRef} onChange={handleGoogleGenerate} accept="image/*" className="hidden" />

                                <div className="flex gap-2 mb-3">
                                    <button type="button" onClick={() => aiInputRef.current.click()} disabled={isGenerating}
                                        className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-xl font-bold text-sm hover:shadow-lg transition flex items-center justify-center gap-2 transform active:scale-95">
                                        {isGenerating ? <i className="fa-solid fa-circle-notch fa-spin"></i> : <i className="fa-solid fa-wand-magic-sparkles"></i>}
                                        {isGenerating ? 'Gemini —Ä–∏—Å—É–µ—Ç...' : '–°–æ–∑–¥–∞—Ç—å —à–µ–¥–µ–≤—Ä –∏–∑ —Ñ–æ—Ç–æ'}
                                    </button>
                                </div>
                                {imageUrl && (
                                    <div className="relative h-48 rounded-lg overflow-hidden border border-slate-300 shadow-inner group">
                                        <img src={imageUrl} className="w-full h-full object-cover transition duration-500 group-hover:scale-105" />
                                        <button type="button" onClick={() => setImageUrl('')} className="absolute top-2 right-2 bg-black/50 hover:bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center transition">
                                            <i className="fa-solid fa-times"></i>
                                        </button>
                                    </div>
                                )}
                                {!imageUrl && (
                                    <div className="text-center text-xs text-slate-400">
                                        –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ, —á—Ç–æ–±—ã —Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ. <br/>AI —É–ª—É—á—à–∏—Ç –æ—Å–≤–µ—â–µ–Ω–∏–µ –∏ –ø–æ–¥–∞—á—É.
                                    </div>
                                )}
                            </div>

                            <input className="w-full border p-2 rounded" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value={name} onChange={e => setName(e.target.value)} required />
                            <textarea className="w-full border p-2 rounded" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" value={desc} onChange={e => setDesc(e.target.value)} rows="3" />

                            <div className="grid grid-cols-3 gap-4">
                                <input className="w-full border p-2 rounded" type="number" placeholder="–¶–µ–Ω–∞" value={price} onChange={e => setPrice(e.target.value)} required />
                                <input className="w-full border p-2 rounded" type="number" placeholder="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞" value={sort} onChange={e => setSort(e.target.value)} />
                                <div className="relative">
                                    <input className="w-full border p-2 rounded" type="number" placeholder="‚àû" value={stock === null ? '' : stock} onChange={e => setStock(e.target.value === '' ? null : parseInt(e.target.value))} />
                                    <span className="absolute right-2 top-2 text-xs text-slate-400 pointer-events-none">–û—Å—Ç–∞—Ç–æ–∫</span>
                                </div>
                            </div>
                            <p className="text-xs text-slate-400 mt-1 mb-2">–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ "–û—Å—Ç–∞—Ç–æ–∫" –ø—É—Å—Ç—ã–º –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.</p>

                            <div>
                                <label className="block text-sm font-bold mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                                <div className="flex flex-wrap gap-2">
                                    {categories.map(c => (
                                        <button type="button" key={c.id} onClick={() => toggleCat(c.id)}
                                            className={`px-3 py-1 text-xs rounded-full border ${selectedCats.includes(c.id) ? 'bg-amber-500 text-white border-amber-500' : 'bg-white text-slate-600'}`}>
                                            {c.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {!imageUrl && (
                                <div className="mt-4 pt-4 border-t border-slate-100">
                                    <label className="block text-sm font-bold mb-1">–û–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</label>
                                    <input type="file" onChange={e => setFile(e.target.files[0])} className="text-sm text-slate-500" />
                                </div>
                            )}

                            <label className="flex items-center gap-2 mt-2">
                                <input type="checkbox" checked={active} onChange={e => setActive(e.target.checked)} /> –ê–∫—Ç–∏–≤–Ω–æ
                            </label>

                            <div className="flex justify-end gap-2 mt-6">
                                <button type="button" onClick={onClose} className="px-4 py-2 bg-slate-100 rounded hover:bg-slate-200 transition">–û—Ç–º–µ–Ω–∞</button>
                                <button className="px-6 py-2 bg-amber-500 text-white rounded font-bold hover:bg-amber-600 shadow-md transition">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            )
        }

        function SliderManager() {
            const [slides, setSlides] = useState([]);
            const [formOpen, setFormOpen] = useState(false);
            const [title, setTitle] = useState('');
            const [desc, setDesc] = useState('');
            const [file, setFile] = useState(null);

            const fetchSlides = async () => {
                const res = await fetch('/api/slider/');
                setSlides(await res.json());
            };
            useEffect(() => { fetchSlides(); }, []);

            const handleCreate = async (e) => {
                e.preventDefault();
                const fd = new FormData();
                fd.append('title', title);
                fd.append('description', desc);
                if (file) fd.append('image', file);

                await fetch('/api/slider/', { method: 'POST', body: fd });
                setFormOpen(false); setTitle(''); setDesc(''); setFile(null);
                fetchSlides();
            };

            const handleDelete = async (id) => {
                if(!confirm("–£–¥–∞–ª–∏—Ç—å –±–∞–Ω–Ω–µ—Ä?")) return;
                await fetch(`/api/slider/${id}`, { method: 'DELETE' });
                fetchSlides();
            };

            return (
                <div>
                     <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold text-slate-800">–†–µ–∫–ª–∞–º–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä—ã</h2>
                        <button onClick={() => setFormOpen(true)} className="bg-amber-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-amber-600 shadow-lg transition">
                            <i className="fa-solid fa-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä
                        </button>
                    </div>

                    <div className="grid grid-cols-1 gap-6">
                        {slides.map(s => (
                            <div key={s.id} className="bg-white rounded-2xl shadow-sm border overflow-hidden flex h-48">
                                <img src={s.image_url} className="w-1/3 object-cover" />
                                <div className="p-6 flex-1 flex flex-col justify-center">
                                    <h3 className="text-2xl font-bold">{s.title}</h3>
                                    <p className="text-slate-500">{s.description}</p>
                                </div>
                                <button onClick={() => handleDelete(s.id)} className="px-6 text-red-400 hover:text-red-600 hover:bg-red-50 transition border-l border-slate-100">
                                    <i className="fa-solid fa-trash text-xl"></i>
                                </button>
                            </div>
                        ))}
                    </div>

                    {formOpen && (
                        <div className="modal-overlay" onClick={() => setFormOpen(false)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <h3 className="text-2xl font-bold mb-4">–ù–æ–≤—ã–π –±–∞–Ω–Ω–µ—Ä</h3>
                                <form onSubmit={handleCreate} className="space-y-4">
                                    <input className="w-full border p-2 rounded" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" value={title} onChange={e => setTitle(e.target.value)} required />
                                    <input className="w-full border p-2 rounded" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" value={desc} onChange={e => setDesc(e.target.value)} />
                                    <input type="file" onChange={e => setFile(e.target.files[0])} required />
                                    <button className="w-full bg-amber-500 text-white py-2 rounded font-bold">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            )
        }
        function SettingsManager() {
            const [tableCount, setTableCount] = useState(10);
            const [isSaving, setIsSaving] = useState(false);
            const [tables, setTables] = useState([]); // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
            const menuLink = `${window.location.origin}/r/${RESTAURANT_ID}`;

            const fetchTables = async () => {
                const res = await fetch('/api/admin/tables/status');
                if (res.ok) setTables(await res.json());
            };

            useEffect(() => {
                fetchTables();
                const interval = setInterval(fetchTables, 10000); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑ –≤ 10 —Å–µ–∫
                return () => clearInterval(interval);
            }, []);

            const resetTable = async (tableId) => {
                if(!confirm("–°–±—Ä–æ—Å–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —ç—Ç–æ–º —Å—Ç–æ–ª–µ?")) return;
                const res = await fetch(`/api/admin/tables/${tableId}/reset`, { method: 'POST' });
                if (res.ok) fetchTables();
            };

            const handleSave = async () => {
                setIsSaving(true);
                try {
                    await fetch('/api/settings', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ table_count: tableCount })
                    });
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –°—Ç–æ–ª–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.');
                    fetchTables();
                } catch(e) {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                } finally {
                    setIsSaving(false);
                }
            };

            const copyLink = () => {
                navigator.clipboard.writeText(menuLink);
                alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            };

            return (
                <div className="max-w-4xl">
                    <h2 className="text-3xl font-bold mb-6 text-slate-800">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</h2>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="space-y-6">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                <h3 className="text-xl font-bold mb-4"><i className="fa-solid fa-link mr-2 text-amber-500"></i>–°—Å—ã–ª–∫–∞ –Ω–∞ –º–µ–Ω—é</h3>
                                <p className="text-sm text-slate-500 mb-3">–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –≥–æ—Å—Ç–µ–π (–±–µ–∑ –Ω–æ–º–µ—Ä–∞ —Å—Ç–æ–ª–∞):</p>
                                <div className="flex gap-2">
                                    <input readOnly value={menuLink} className="flex-1 bg-slate-50 border p-2 rounded-lg text-sm text-slate-600" />
                                    <button onClick={copyLink} className="bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 rounded-lg font-bold transition">
                                        <i className="fa-regular fa-copy"></i>
                                    </button>
                                </div>
                                <div className="mt-4">
                                    <a href={menuLink} target="_blank" className="text-amber-500 hover:underline text-sm font-bold">
                                        –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ <i className="fa-solid fa-external-link-alt ml-1"></i>
                                    </a>
                                </div>
                            </div>

                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                <h3 className="text-xl font-bold mb-4">–°—Ç–æ–ª–∏–∫–∏</h3>
                                <div className="mb-4">
                                    <label className="block text-sm font-bold text-slate-700 mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–∏–∫–æ–≤</label>
                                    <input type="number" min="1" max="100" value={tableCount} onChange={e => setTableCount(e.target.value)}
                                           className="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-amber-500 outline-none" />
                                    <p className="text-xs text-slate-400 mt-2">–ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –Ω–æ–≤—ã–µ QR-–∫–æ–¥—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ PDF –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
                                </div>
                                <button onClick={handleSave} disabled={isSaving} className="w-full bg-slate-800 text-white font-bold py-3 px-6 rounded-xl hover:bg-slate-700 transition disabled:opacity-50">
                                    {isSaving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è'}
                                </button>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col">
                            <h3 className="text-xl font-bold mb-4"><i className="fa-solid fa-qrcode mr-2 text-blue-500"></i>QR –ú–µ–Ω—é (PDF)</h3>

                            <div className="flex-1 bg-slate-100 rounded-xl p-4 mb-6 border border-slate-200 flex flex-col items-center justify-center">
                                <p className="text-xs text-slate-400 font-bold mb-2 uppercase tracking-wider">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–∞–∫–µ—Ç–∞</p>

                                <div className="bg-white w-48 h-64 shadow-xl border border-slate-200 relative flex flex-col items-center p-4 text-center">
                                    <div className="absolute inset-0 border-2 border-dashed border-slate-300 pointer-events-none"></div>

                                    <div className="bg-slate-800 text-white w-full py-1 rounded mb-2 text-[10px] font-bold uppercase truncate px-1">
                                        {RESTAURANT_NAME}
                                    </div>
                                    <div className="w-20 h-20 bg-slate-900 mb-2 flex items-center justify-center">
                                        <i className="fa-solid fa-qrcode text-white text-3xl"></i>
                                    </div>
                                    <div className="text-amber-500 font-bold text-3xl leading-none">1</div>
                                    <div className="text-[8px] text-slate-500 uppercase font-bold mb-2">Table Number</div>
                                    <div className="font-bold text-xs">SCAN TO ORDER</div>
                                    <div className="text-[8px] text-slate-400">No app download</div>

                                    <div className="mt-auto text-amber-500 font-bold text-xl">1</div>
                                </div>
                                <p className="text-xs text-slate-400 mt-3 text-center">–§–æ—Ä–º–∞—Ç –ê4, 4 –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ –ª–∏—Å—Ç.<br/>–ì–æ—Ç–æ–≤–æ –∫ –ø–µ—á–∞—Ç–∏.</p>
                            </div>

                            <a href="/admin/download_qr" target="_blank" className="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-600/20 text-center flex items-center justify-center">
                                <i className="fa-solid fa-file-pdf mr-2"></i>–°–∫–∞—á–∞—Ç—å PDF –º–∞–∫–µ—Ç
                            </a>
                        </div>
                    </div>

                    <div className="mt-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 className="text-xl font-bold mb-4"><i className="fa-solid fa-desktop mr-2 text-indigo-500"></i>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–æ–ª–æ–≤</h3>
                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                            {tables.map(table => (
                                <div key={table.id} className={`p-4 rounded-xl border text-center transition ${table.active ? 'bg-amber-50 border-amber-200' : 'bg-slate-50 border-slate-100'}`}>
                                    <div className="font-bold text-slate-800">–°—Ç–æ–ª ‚Ññ{table.number}</div>
                                    <div className="text-[10px] uppercase font-bold mt-1 text-slate-500">{table.status}</div>
                                    {table.created_at && <div className="text-[10px] bg-slate-800 text-white inline-block px-1 rounded mt-1">{table.created_at}</div>}
                                    <div className="mt-3">
                                        {table.active ? (
                                            <button onClick={() => resetTable(table.id)} className="text-[10px] bg-red-500 text-white px-3 py-1 rounded-lg font-bold hover:bg-red-600 transition">–°–ë–†–û–°–ò–¢–¨</button>
                                        ) : (
                                            <span className="text-[10px] text-slate-400 font-bold">–°–í–û–ë–û–î–ï–ù</span>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminPanel />);
    {% endraw %}
    </script>
</body>
</html>